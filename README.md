Создать Rest API которое состоит из 5-х методов
============

Установка:<br>
1.Развернуть на своем localhost клонируя репозиторий<br>
2.Обновить в composer с помощью - composer update<br>
3.Создать бд - php bin/console doctrine:database:create<br>
4.В корне лежит база данных rest.sql. Импортировать ее в созданную базу вручную<br>
5.Запустить сервер через консоль - php bin\console server:run<br>
6.Тестирование по адресу - http://localhost:8000/<br><br>

Реализовано 5 методов:<br>
1)http://localhost:8000/users/Registration<br>
2)http://localhost:8000/users/Auth<br>
3)http://localhost:8000/users/addOrder<br>
4)http://localhost:8000/users/setOrderStatus<br>
5)http://localhost:8000/users/getMapInfo<br>

1. Метод авторизации

Название метода - Auth
Тип запроса - POST

Параметры запроса:
- key, метод выполняется всегда с зашитым ключем в приложение, после того как пользователь розлогинелся на клиенте нужно удалять токен с целью безопасности но на сервере токен который закреплен за его аккаунтом сохраняется и после успешной авторизации отправляется на клиент.
- пароль (MD5 шифрование)
- номер телефона

Параметр ответа:
-  user_id, уникальный идентификатор пользователя
- access token, выданный токен генерируется автоматически и состоит из набора латинских символов и цифр длина 16 символов, данный токен привязывается к email пользователя в момент регистрации. 
- user_status, активен или не активен

2. Регистрация
Название метода - Registration
Тип запроса - POST
Параметры запроса:
- ключ rNkJGSL1sg@Jbz@iFWV8|4fB5lP{n#Z%HGGQtQOb
- имя пользователя 
	- id страны
	- пароль
- номер телефона

Параметр ответа:
-  user_id, уникальный идентификатор пользователя (или driver_id, зависит от приложения с которого проходит регистрация).
 - access token, выданный токен генерируется автоматически и состоит из набора латинских символов и цифр длина 16 символов, данный токен привязывается к id пользователя в момент регистрации. Токен должен записаться в базу MySQL  в таблицу Users и в redis по ключу AccessToken с hash id пользователя value токен. Срок жизни токена не ограничен.


3. Регистрация заказа в системе
Название метода - addOrder
Тип запроса - POST

Параметры запроса:
- access token E@3dkCRjzjN9pskGA2~Ya4?mmPgwvI{K82yz
- текущее местоположения
- id автомобиля
- страна
- регион
- массив точек маршрута (он же предполагаемый маршрут)
- id водителя
- время заказа
Параметр ответа:
-  id заказа
- статус заказа

Пример запроса:
http://example.com/apiv1/addOrder

Тело запроса:
{
"passanger_id":"12",
"access_token":"E@3dkCRjzjN9pskGA2~Ya4?mmPgwvI{K82yz",
"user_location":[
22.333,
34.455
],
"car_id":"32",
"driver_id":"12",
"country_id":"13",
"pass_phone":"380996783492",
"region_id":"12",
"route_points":[
{
"adress":"Ukraine, Dnipro, Malinovskogo 2",
"lat":"45.32323",
"lon":"39.544645",
"sort":"1"
},
{
"adress":"Ukraine, Dnipro, Malinovskogo 2",
"lat":"45.32323",
"lon":"39.544645",
"sort":"2"
},
{
"adress":"Ukraine, Dnipro, Malinovskogo 2",
"lat":"45.32323",
"lon":"39.544645",
"sort":"3"
}
],
"start_time":"2016-09-25 14:55",
"pass_count":"4",
"callme":"0",
"large":"1",
"pets":"1",
"wishlist_option_id":[
1,
2
],
"baby_chair":"1-4",
"payment_type_id":"2",
"deffered_payment":"1",
"duration":"12",
"extension":"1:33:00",
"comment":"test comment"
}


Ответы:
Success
{
"order_id":"1",
"oredr_status_id":"0",
"order_status":"Ожидает ответ водителя"
}


Error {"Error":"Invalide access token: dfhkdt65465GFOFY4562321rstjdr"} - неверный токен


Error {"Error":"'Method' is not defined"} - не указан или неверно указан идентификатор запроса, или неверно указаны параметры запроса.


Error {"Error":" "Incorrect parameters of method"} - не все параметры в методе или некорректное название параметров.


Error {“Error”:”User id not found”} - пользователь с таким id не существует


Описание логики выполнения метода
Метод резервирует заказ в системе, создает его в таблице Orders в БД, но он имеет состояние неактивного (в колонке active). Дальше по driver_id делается отправка push сообщения на устройство данного водителя, в своем приложении водитель должен принять заказ или отклонить. 


Если водитель принял заказ
Заказ становится активным и меняет свое состояние, на устройство пользователя который осуществляет заказ отправляется push (подробнее ниже) о том что водитель принял заказ.


{
"order_id":"1",
"oredr_status_id":"1",
"order_status":"Водитель принял заказ"
}


Если водитель не принял заказ
Заказ удаляется с БД и отправляется ответ на мобильный клиент через push.


{
"oredr_status_id":"5",
"order_status":"Водитель отклонил заказ"
}


Если заказ срочный то мобильный клиент автоматом выбирает следующего водителя и  уже с новыми параметрами машины и водителя повторяет данный запрос.


Данный запрос должен выполняться через Gearman как фоновый процесс.

4. Установка статуса заказа водителем и пассажиром
Название метода - setOrderStatus
Тип запроса - PUT

Параметры запроса:
- access token E@3dkCRjzjN9pskGA2~Ya4?mmPgwvI{K82yz
- driver_id
- order_id
- status

Параметр ответа:
-  success


Пример запроса:
https://example.com/apiv1/setOrderStatus/


Тело запроса:
{
"access_token":"JY4e0ZNgYxnMef99",
"driver_id":"19",
"order_id":"19",
"bundle":"com.7likes.taxi.driver",
"oredr_status_id":"0",
"fact_route":[
{
"adress":"Ukraine, Dnipro, Malinovskogo 2",
"lat":"45.32323",
"lon":"39.544645",
"sort":"1"
},
{
"adress":"Ukraine, Dnipro, Malinovskogo 2",
"lat":"45.32323",
"lon":"39.544645",
"sort":"2"
},
{
"adress":"Ukraine, Dnipro, Malinovskogo 2",
"lat":"45.32323",
"lon":"39.544645",
"sort":"3"
}
]
}


Ответы:
Success {"success":"1"}


Error {"Error":"Invalide access token: dfhkdt65465GFOFY4562321rstjdr"} - неверный токен


Error {"Error":"'Method' is not defined"} - не указан или неверно указан идентификатор запроса, или неверно указаны параметры запроса.


Error {"Error":" "Incorrect parameters of method"} - не все параметры в методе или некорректное название параметров.


Error {“Error”:”User id not found”} - пользователь с таким id не существует


Описание логики выполнения метода
Данный метод предназначен для изменения статуса заказа водителем, когда заказ резервируется на сервере то водитель для начала должен его принять или отклонить, ниже описана логика.
После того как пользователь делает заказ он уходит на сервер и делается резервация заказа (описано в предыдущем методе), после резервирования заказа происходит отправка push сообщения на мобильный клиент водителю в качестве идентификатора служит id водителя по нему выбирается нужный токен и делается отправка данных.


Пример push сообщения:
{
"order_id":"19"
}


После того как приложение водителя получает push при переходе чрез него в приложение открывается всплывающие окно с заказом который должен принять или отклонить водитель (если заказ принят отправляем status -1, если отклонен status -0), для получения информации о заказе мобильный клиент выполняет запрос на получения заказа по id, пока выполняется заказа на экране должен быть лоадер при этом должна отобразится карта и появится лоадер.
Дальше в зависимости от действия водителя (принять/отмена) отправляется данный запрос, после того как данный запрос приходит на сервер должен отправится push на мобильное устройство пользователя который оставил заказ (push описан в предыдущем методе).


После того как заказ был принять водителем есть несколько стадий заказа которые отмечаются водителем с приложения, ниже описаны шаги:
после того как водитель принял заказ он отправляется к месту посадки пассажира, по прибытию в точку он нажимает кнопку “Авто подано” и отправляется данный запрос с кодом статуса 2, сервер после того как принимает данный статус переводит заказ в статус авто подано.
после того как пассажир сел в авто водитель нажимает на кнопку “Клиент в авто” и отправляет запрос с кодом статуса 3, сервер переводит заказ в соответствующий статус.
после прибытия в точку водитель нажимает на кнопку “Поездка завершена” и отправляется запрос с кодом статуса 4, сервер завершает заказ. При установке статуса 4 с устройства водителя должен обязательно приходить накопленный фактический маршрут. При установке остальных статусов массив fact_route приходит пустой.
если с мобильного приложения пассажира приходит отказ (запрос выполняется с bandle приложения пассажира и статус кодом 6), то заказ блокируется.


Водитель может установить заказу только статусы:
1 - заказ принят,
2 - авто подано,
3 - клиент в авто,
4 - поездка завершена,
5 - заказ отклонен
Статусы 1 и 5 устанавливаются на первом шаге, после получения push уведомления о новом заказе, статусы со 2-го по 4-й выполняются только по очереди и не могут выполнятся в другом порядке.


Клиент может установить только статус 6 - отмена заказа,  отмена возможна в период с 1 по 3 этапы, после того как водитель установил статус 3 отмена заказа невозможна.
Проверки должны быть как в мобильных клиентах так и на стороне сервера.

5. Получить данные для отображения карты
Название метода - getMapInfo
Тип запроса - GET

Параметры запроса:
- access token E@3dkCRjzjN9pskGA2~Ya4?mmPgwvI{K82yz
- текущее местоположения

Параметр ответа:
-  массив объектов машины


Пример запроса:
http://example.com/apiv1/getMapInfo?access_token=E@3dkCRjzjN9pskGA2~Ya4?mmPgwvI{K82yz&lat=24.454554455&lng=23.4544545455


Ответы:
Success
{
"cars":[
{
"id":"2",
"status":"1",
"color":"red",
"direction":"300",
"reg_number":"AA 2345",
"yer":"2014",
"brand":"Audi",
"model":"A4",
"currency":"frn",
"planting_costs":"32",
"driver_phone":"380976357289",
"costs_per_1":"2",
"car_photo":"http://example.com/data/cars/mercedes-ml.png",
"location":{
"lat":"23.333",
"lan":"45.3434"
}
},
{
"id":"3",
"driver_id":"4",
"status":"1",
"color":"red",
"direction":"300",
"reg_number":"AA 2345",
"yer":"2014",
"brand":"Audi",
"model":"A4",
"currency":"frn",
"planting_costs":"32",
"driver_phone":"380976357289",
"car_photo":"http://example.com/data/cars/mercedes-ml.png",
"costs_per_1":"2",
"location":{
"lat":"23.333",
"lan":"45.3434"
}
}
]
}


Error {"Error":"Invalide access token: dfhkdt65465GFOFY4562321rstjdr"} - неверный токен


Error {"Error":"'Method' is not defined"} - не указан или неверно указан идентификатор запроса, или неверно указаны параметры запроса.


Error {"Error":" "Incorrect parameters of method"} - не все параметры в методе или некорректное название параметров.


Error {“Error”:”User id not found”} - пользователь с таким id не существует


Описание логики выполнения метода
Метод возвращает список автомобилей с их параметрами. 
Отправляются только активные автомобили.
